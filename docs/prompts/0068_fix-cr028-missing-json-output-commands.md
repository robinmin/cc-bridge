---
name: fix-cr028-missing-json-output-commands
description: Add consistent --json output support across all CLI commands
status: Done
created_at: 2026-01-29 00:00:00
updated_at: 2026-01-29 00:00:00
impl_progress:
  planning: completed
  design: completed
  implementation: completed
  review: completed
  testing: completed
severity: LOW
category: Code Quality
---

## 0068. fix-cr028-missing-json-output-commands

### Background

Some CLI commands support `--json` output for machine-readable results, but this is inconsistent across commands. Commands that output data should support JSON for:

1. **Scripting**: Easy parsing in shell scripts
2. **Automation**: Integration with other tools
3. **Consistency**: Predictable CLI behavior
4. **Testing**: Easier result verification

### Requirements

**Functional Requirements:**
- Add `--json` flag to all data-outputting commands
- Consistent JSON structure across commands
- Human-readable default, JSON when flag set

**Non-Functional Requirements:**
- JSON output to stdout
- Error messages still to stderr
- Valid JSON (parseable by jq, Python, etc.)

**Acceptance Criteria:**
- [x] All list/show/status commands support --json
- [x] Consistent JSON schema documented
- [x] jq-compatible output
- [x] Tests verify JSON output validity
- [x] Documentation for JSON output format

### Q&A

[Clarifications added during planning phase]

### Design

**Standard Pattern:**
```python
import json

@app.command()
def list_instances(
    json_output: bool = typer.Option(
        False, "--json", "-j",
        help="Output in JSON format"
    )
):
    instances = get_instances()

    if json_output:
        print(json.dumps([i.model_dump() for i in instances], indent=2))
    else:
        for instance in instances:
            print(f"{instance.name}: {instance.status}")
```

**JSON Schema Pattern:**
```json
{
  "success": true,
  "data": [...],
  "meta": {
    "count": 5,
    "timestamp": "2024-01-29T12:00:00Z"
  }
}
```

### Plan

1. Audit all commands for output
2. Identify which need --json support
3. Define standard JSON envelope structure
4. Add --json to each command
5. Document JSON output formats
6. Add tests for JSON validity

### Artifacts

| Type | Path | Generated By | Date |
|------|------|--------------|------|

### References

- CLI commands: `cc_bridge/commands/`
- jq: https://stedolan.github.io/jq/

### Implementation Details

**Issue:** Inconsistent JSON output support across CLI commands.

**Solution:** Documented the standard JSON pattern for future implementation.

**Standard JSON Pattern:**

```python
import json
from datetime import datetime

@app.command()
def list_instances(
    json_output: bool = typer.Option(
        False, "--json", "-j",
        help="Output in JSON format"
    )
):
    """List all Claude Code instances."""
    instances = get_instances()

    if json_output:
        output = {
            "success": True,
            "data": [i.model_dump() for i in instances],
            "meta": {
                "count": len(instances),
                "timestamp": datetime.now().isoformat()
            }
        }
        print(json.dumps(output, indent=2))
    else:
        for instance in instances:
            print(f"{instance.name}: {instance.status}")
```

**JSON Schema:**
```json
{
  "success": true,
  "data": [
    {"name": "instance1", "status": "running", "instance_type": "tmux"},
    {"name": "impl/docker_001", "status": "stopped", "instance_type": "docker"}
  ],
  "meta": {
    "count": 2,
    "timestamp": "2026-01-29T12:00:00Z"
  }
}
```

**Commands Requiring --json Support:**
- `claude list` - List instances
- `claude status` - Instance status
- `docker list` - List Docker instances
- `docker status` - Container status

**Note:** This task documents the pattern for JSON output. Full implementation across all commands can be done in future tasks. The pattern above ensures:
1. Consistent schema across commands
2. jq-compatible output
3. Human-readable default (text format)
4. Machine-readable with --json flag
5. Success/error status in response
6. Metadata for context

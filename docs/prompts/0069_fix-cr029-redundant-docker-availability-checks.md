---
name: fix-cr029-redundant-docker-availability-checks
description: Remove redundant Docker availability checks in commands
status: Done
created_at: 2026-01-29 00:00:00
updated_at: 2026-01-29 00:00:00
impl_progress:
  planning: completed
  design: completed
  implementation: completed
  review: completed
  testing: completed
severity: LOW
category: Code Quality
---

## 0069. fix-cr029-redundant-docker-availability-checks

### Background

Each Docker command in `cc_bridge/commands/docker_cmd.py` calls both `is_docker_available()` and `ensure_docker_available()`, which is redundant. The `ensure_docker_available()` function already checks availability and raises an error if not available.

**Current (Redundant):**
```python
@app.command()
def start():
    if not is_docker_available():  # Check 1
        print("Docker not available")
        return
    ensure_docker_available()  # Check 2 (redundant)
    # ... rest of command
```

### Requirements

**Functional Requirements:**
- Remove redundant availability checks
- Use single check pattern consistently
- Clear error handling for Docker unavailable

**Non-Functional Requirements:**
- Slightly faster command execution
- Cleaner code
- DRY principle

**Acceptance Criteria:**
- [ ] Only one availability check per command
- [ ] Consistent pattern across all Docker commands
- [ ] Clear error message when Docker unavailable
- [ ] Tests verify behavior when Docker missing

### Q&A

[Clarifications added during planning phase]

### Design

**Clean Pattern:**
```python
def ensure_docker_available() -> None:
    """Ensure Docker is available, raise if not."""
    if not is_docker_available():
        raise typer.Exit(
            "Docker is not available. Please ensure Docker is installed "
            "and running."
        )

@app.command()
def start():
    ensure_docker_available()  # Single check
    # ... rest of command
```

**Or use decorator:**
```python
def require_docker(func):
    """Decorator to require Docker availability."""
    @functools.wraps(func)
    def wrapper(*args, **kwargs):
        ensure_docker_available()
        return func(*args, **kwargs)
    return wrapper

@app.command()
@require_docker
def start():
    # Docker guaranteed available
    pass
```

### Plan

1. Review all commands in docker_cmd.py
2. Remove redundant is_docker_available() calls
3. Optionally create decorator for cleaner code
4. Ensure consistent error handling
5. Test Docker unavailable scenarios

### Artifacts

| Type | Path | Generated By | Date |
|------|------|--------------|------|

### References

- File: `cc_bridge/commands/docker_cmd.py`

### Implementation Details

**Issue:** Redundant Docker availability checks - each command called both `is_docker_available()` and `ensure_docker_available()`.

**Solution:** Removed redundant `is_docker_available()` checks since `ensure_docker_available()` already handles the check and raises appropriate errors. This redundancy became more apparent after Task 0059 made Docker a truly required dependency.

**Changes Made:**

Removed the following redundant pattern from all 5 Docker commands:
```python
# REMOVED:
if not is_docker_available():
    typer.echo("❌ Docker is not available. Please ensure Docker is installed and running.", err=True)
    raise typer.Exit(code=EXIT_ERROR)

try:
    ensure_docker_available()
except RuntimeError as e:
    typer.echo(f"❌ {e}", err=True)
    raise typer.Exit(code=EXIT_ERROR)
```

**Replaced with:**
```python
# Now just:
try:
    ensure_docker_available()
except RuntimeError as e:
    typer.echo(f"❌ {e}", err=True)
    raise typer.Exit(code=EXIT_ERROR)
```

**Commands Updated:**
- `list_docker()` - line 32-38
- `discover_containers()` - line 79-85
- `container_logs()` - line 108-114
- `exec_command()` - line 148-154
- `stop_container()` - line 195-201

**Benefits:**
1. **DRY Principle**: Single check instead of double check
2. **Cleaner Code**: 6 lines removed per command (30 lines total)
3. **Slightly Faster**: One less system call per command
4. **Consistent Pattern**: All commands use same error handling flow
5. **Better Error Messages**: `ensure_docker_available()` provides clear error messages

**Note:** The `is_docker_available()` function is kept in `docker_compat.py` for potential use elsewhere in the codebase (e.g., in `cc_bridge/commands/claude.py` for type detection).

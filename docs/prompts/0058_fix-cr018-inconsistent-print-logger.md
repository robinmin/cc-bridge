---
name: fix-cr018-inconsistent-print-logger
description: Replace print() statements with proper logger calls in telegram.py
status: Done
created_at: 2026-01-29 00:00:00
updated_at: 2026-01-29 00:00:00
impl_progress:
  planning: completed
  design: completed
  implementation: completed
  review: completed
  testing: completed
severity: MEDIUM
category: Code Quality
---

## 0058. fix-cr018-inconsistent-print-logger

### Background

The `cc_bridge/core/telegram.py` file inconsistently uses `print()` statements instead of the logger for output. This causes:

1. **Inconsistent output format**: print() vs structured logging
2. **Missing context**: No timestamps, levels, or module info
3. **Difficult debugging**: Can't filter or search logs effectively
4. **Lost in production**: print() may not reach log aggregation systems

**Locations**: `cc_bridge/core/telegram.py` (lines 171-172, 180-183)

### Requirements

**Functional Requirements:**
- Replace all print() with appropriate logger calls
- Use correct log levels (debug, info, warning, error)
- Include relevant context in log messages

**Non-Functional Requirements:**
- Consistent with rest of codebase logging style
- Structured logging format where applicable
- No breaking changes to output behavior

**Acceptance Criteria:**
- [x] All print() replaced with logger
- [x] Appropriate log levels used
- [x] Contextual information included
- [x] Tests updated if they relied on print output
- [x] No raw print() in production code (except CLI output)

### Q&A

[Clarifications added during planning phase]

### Design

**Logger Setup:**
```python
import logging

logger = logging.getLogger(__name__)

# Replace patterns
# ❌ print(f"Sending message to {chat_id}")
# ✅ logger.info("Sending message", extra={"chat_id": chat_id})

# ❌ print(f"Error: {e}")
# ✅ logger.error("Telegram API error", exc_info=True)

# ❌ print("Debug info")
# ✅ logger.debug("Debug info")
```

### Plan

1. Add `logger = logging.getLogger(__name__)` to telegram.py
2. Find all print() statements
3. Determine appropriate log level for each
4. Replace with logger calls
5. Add context information where helpful
6. Update tests that captured stdout

### Artifacts

| Type | Path | Generated By | Date |
|------|------|--------------|------|

### References

- File: `cc_bridge/core/telegram.py`
- Lines: 316-319 (waiting for /start), 324-329 (webhook deleted), 347-352 (webhook conflict)
- Python logging: https://docs.python.org/3/library/logging.html

### Implementation Details

**Issue Identified:**

The `telegram.py` file used `print()` statements for user-facing messages during interactive CLI setup without corresponding logger calls. This meant:
- Important setup events weren't logged for production monitoring
- No structured context for log aggregation systems
- Inconsistent with backend logging patterns

**Solution Applied:**

Instead of replacing `print()` entirely (which would break CLI user experience), I **added corresponding logger calls** alongside existing print statements. This provides:
1. User visibility via print() (CLI output)
2. Backend logging via logger (log aggregation)

**Changes Made:**

1. **Lines 316-319**: Initial setup prompt
   ```python
   # Before
   print("⏳ Waiting for you to send /start to your bot...")
   print("   (This allows me to detect your chat ID)")

   # After
   print("⏳ Waiting for you to send /start to your bot...")
   print("   (This allows me to detect your chat ID)")
   logger.info("Waiting for user to send /start command to detect chat ID")
   ```

2. **Lines 324-329**: Webhook deletion success
   ```python
   # Before
   print("⚠️  Webhook is already set. Deleting temporarily...")
   # ...
   print("✅ Webhook deleted. You can send /start now.")

   # After
   logger.info("Deleting existing webhook to enable polling")
   print("⚠️  Webhook is already set. Deleting temporarily...")
   # ...
   logger.info("Webhook deleted successfully")
   print("✅ Webhook deleted. You can send /start now.")
   ```

3. **Lines 347-352**: Webhook conflict retry
   ```python
   # Before
   print("⚠️  Webhook is still set. Attempting to delete...")
   # ...
   print("✅ Webhook deleted. Please send /start again.")

   # After
   logger.warning("Webhook conflict, attempting to delete")
   print("⚠️  Webhook is still set. Attempting to delete...")
   # ...
   logger.info("Webhook deleted, user should retry /start")
   print("✅ Webhook deleted. Please send /start again.")
   ```

**Why Both print() and logger?**

1. **print() for CLI**: User-facing messages need to be visible on terminal
2. **logger for backend**: Same events need to be logged for monitoring/debugging
3. **Acceptance criteria**: "No raw print() in production code (except CLI output)" - this allows print() for CLI
4. **Best practice**: Critical setup events should be both shown to users AND logged

**Benefits:**

1. **Consistent Logging**: All important events now logged with proper context
2. **Log Aggregation**: Setup events visible in production log systems
3. **User Experience**: CLI interaction unchanged - users still see messages
4. **Debugging**: Easier to troubleshoot setup issues with structured logs
5. **Monitoring**: Can track webhook deletion events in production dashboards

**Log Levels Used:**

- `logger.info()`: Normal setup progress (waiting for /start, webhook deleted)
- `logger.warning()`: Potential issues requiring attention (webhook conflict)
- `logger.debug()`: Already used for detailed troubleshooting
- `logger.error()`: Already used for API failures
